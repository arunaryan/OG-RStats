<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans>

  <!-- Default XML --> 
  <import resource="classpath:/com/opengamma/language/connector/Client.xml" />
  
  <!-- Use ActiveMQ for JMS -->
  <bean id="defaultJMSConnectionFactory" class="com.opengamma.language.jms.ActiveMQConnectionFactoryFactoryBean">
    <property name="configuration" ref="defaultConfiguration" />
  </bean>
  
  <!-- Custom contexts -->
  <bean id="RGlobalContextFactory" class="com.opengamma.language.context.GlobalContextFactoryBean">
    <property name="extendedFrom" ref="globalContextFactory" />
  </bean>
  <bean id="RUserContextFactory" class="com.opengamma.language.context.UserContextFactoryBean">
    <property name="extendedFrom" ref="userContextFactory" />
    <property name="globalContextFactory" ref="RGlobalContextFactory" />
  </bean>
  <bean id="RSessionContextFactory" class="com.opengamma.language.context.SessionContextFactoryBean">
    <property name="extendedFrom" ref="sessionContextFactory" />
    <property name="userContextFactory" ref="RUserContextFactory" />
  </bean>
  <bean id="RBaseMessageHandler" factory-bean="clientContextFactory" factory-method="getMessageHandler" />
  <bean id="RClientContextFactory" class="com.opengamma.language.connector.ClientContextFactoryBean">
    <constructor-arg ref="clientContextFactory" />
    <property name="messageHandler">
      <bean class="com.opengamma.language.connector.UserMessagePayloadHandler">
        <constructor-arg ref="RBaseMessageHandler" />
        <property name="functionHandler">
          <bean class="com.opengamma.rstats.function.Handler">
            <constructor-arg>
              <bean factory-bean="RBaseMessageHandler" factory-method="getFunctionHandler" />
            </constructor-arg>
          </bean>
        </property>
      </bean>
    </property>
  </bean>

  <!-- R type conversion -->
  <bean class="com.opengamma.language.invoke.Loader">
    <property name="globalContextFactory" ref="RGlobalContextFactory" />
    <property name="typeConverterProvider">
      <bean class="com.opengamma.language.invoke.TypeConverterProviderBean">
        <property name="converters">
          <list>
            <bean class="com.opengamma.rstats.convert.DateTimeConverter" />
            <bean class="com.opengamma.rstats.convert.LocalDateDoubleTimeSeriesConverter" />
          </list>
        </property>
      </bean>
    </property>
  </bean>
  
</beans>
