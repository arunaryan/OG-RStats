<project name="og-pirate" default="compile">

	<property file="${basedir}/build.properties" />
	<import file="${og.language.dir}/build-prefix.xml" />

	<path id="java.build.path">
		<pathelement path="${basedir}/Ext" />
	</path>
	<path id="javatest.build.path">
		<path refid="java.build.path" />
	</path>
	<path id="cc.build.path">
		<pathelement path="${basedir}/Client" />
	</path>
	<path id="cctest.build.path">
		<pathelement path="${basedir}/ClientTest" />
	</path>

	<import file="${og.language.dir}/build-suffix.xml" />

	<target name="unpack-resolve" depends="build-suffix.unpack-resolve">
		<unpack-include org="com.opengamma" name="og-language" />
		<unzip dest="${lib.dir}" overwrite="false">
			<fileset dir="${lib.dir}/lib/com.opengamma/og-language">
				<include name="*.zip" />
			</fileset>
		</unzip>
	</target>

	<target name="compile" depends="build-suffix.compile">
		<subant target="compile" buildpath="${basedir}/package" />
	</target>

	<target name="dist" depends="compile">
		<mkdir dir="${dist.dir}" />
		<mkdir dir="${package.dir}" />
		<subant target="dist" buildpath="${basedir}/package" />
		<subant target="dist" buildpathref="java.build.path" antfile="build.parent-invoked.xml" />
		<subant target="dist" buildpathref="cc.build.path" />
		<zip destfile="${dist.dir}/${ant.project.name}-R.zip" basedir="${dist.dir}/package" />
	</target>

	<target name="test-dist" depends="dist" description="--> Tests the R package distribution using 'R CMD check'">
		<exec executable="R" failonerror="true">
			<arg value="CMD" />
			<arg value="check" />
			<arg value="${package.dir}/opengamma" />
		</exec>
	</target>

	<target name="install" depends="dist" description="--> Installs the R package using 'R CMD INSTALL'">
		<exec executable="R" failonerror="true">
			<arg value="CMD" />
			<arg value="INSTALL" />
			<arg value="${package.dir}/opengamma" />
		</exec>
	</target>

</project>
